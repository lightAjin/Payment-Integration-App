<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Spring Boot Payment Gateway</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
    crossorigin="anonymous"
  >
</head>

<body class="container mt-4">

  <h2 class="mb-4 text-center">Spring Boot with Payment Gateway</h2>

  <table class="table table-borderless w-50 mx-auto">

    <tr>
      <td>Enter Name</td>
      <td>
        <input type="text" name="name" id="name" class="form-control">
      </td>
    </tr>

    <tr>
      <td>Enter Email</td>
      <td>
        <input type="email" name="email" id="email" class="form-control">
      </td>
    </tr>

    <tr>
      <td>Enter Phone Number</td>
      <td>
        <input type="tel" name="phno" id="phno" class="form-control">
      </td>
    </tr>

    <tr>
      <td>Select Course</td>
      <td>
        <select class="form-select" name="course" id="course">
          <option value="">--Select Course--</option>
          <option value="java">Java</option>
          <option value="python">Python</option>
          <option value="ruby">Ruby</option>
          <option value="devops">DevOps</option>
        </select>
      </td>
    </tr>

    <tr>
      <td>Amount</td>
      <td>
        <input type="number" name="amount" id="amount" class="form-control">
      </td>
    </tr>

    <tr>
      <td></td>
      <td>
        <button id="rpz-button1" class="btn btn-primary w-100">
          Proceed To Pay
        </button>
      </td>
    </tr>

  </table>
  
  <!-- Pre-defined file given by Razorpay -->	
	<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
	
<script>
document.addEventListener("DOMContentLoaded", function () {

  async function createOrder() {
    console.log("----- order creation started -----");

    const response = await fetch('/Payment-Integration-App/create-order', {
    	  method: 'POST',
    	  headers: {
    	    'Content-Type': 'application/json'
    	  },
    	  body: JSON.stringify({
    	    name: document.getElementById('name').value,
    	    email: document.getElementById('email').value,
    	    phno: document.getElementById('phno').value,
    	    course: document.getElementById('course').value,
    	    amount: document.getElementById('amount').value
    	  })
    	});

    const order = await response.json();
    console.log("----- order creation completed -----");
    console.log(order);

    return order;
  }

  document.getElementById('rpz-button1')
    .addEventListener('click', async function (e) {
      const order = await createOrder();
      console.log("Order received:", order);
      var options={
		"key":"rzp_test_SEk5oKQzx2MwuJ",
		"amount":order.amount,
		"currency":'INR',
		"name":"Aniket Enterprises",
		"description":"Course Payment",
		"order_id":order.razorpayOrderId,
		"receipt":order.email,
		callback_url: "/Payment-Integration-App/handle-payment-callback",
		"prefill":{
			"name":order.name,
			"email":order.email,
			"contact":order.phno
			},
			"theme":{
				"color":"#3399cc"	
			}
      };
      var rzp1=new Razorpay(options);
      rzp1.open();
      e.preventDefault();
    });

});
</script>

	
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous">
  </script>

</body>
</html>
